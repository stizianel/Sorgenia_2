<root>
	<queries>
	<RateAggregator>
		<mainSelect ><![CDATA[
        SELECT /*+ ORDERED FULL(i) FULL(a) FULL(d) USE_HASH(v d a b) */
       v.Dbi_Original_Key_Pr , --0
       v.CPOD, --1
       a.Operando,
       Get_Ab2(b.Operando, a.Ctar1, v.cdsti, Data_Validita)        , --3
       Get_Bis2(b.Operando,a.Ctar1,v.cdsti,v.cdces,Data_Validita_Al) , --4
      Get_Param_Valori_Tarifart(a.Operando,a.Ctar1,Dec_Stagruver(v.Ctfor),Dec_Spebene(v.Crete, d.Tensione),TRIM(TO_CHAR(d.potenza_impegnata)),DEC_CTFOR(v.CTFOR),l.Indprov,l.Indccom,d.Cd_Tariffa_Distr_norm,A.ACQUISIZIONE)  , --5
       GET_PARAM_VALORI_KOND(a.Operando,a.Ctar1,Dec_Stagruver(v.Ctfor),Dec_Spebene(v.Crete, d.Tensione),TRIM(TO_CHAR(d.potenza_impegnata)),DEC_CTFOR(v.CTFOR),l.Indprov,l.Indccom,d.Cd_Tariffa_Distr_norm,A.ACQUISIZIONE,v.d_valido_dal) , --6
       b.Id_Operando
  FROM z_Test_Contratti                     i
    , Dbi_User.Ifc_Sap_Anagrcontrele       v
     , Dbi_User.Ifc_Sap_Punti_Fornitura     d
     , z_Prodotto_Operando                  a
     , z_Anagrafica_Operandi                b
     , Dbi_User.Ifc_Sap_Anagrindirizzi_pr   g
     , v_Indirizzi                          l
WHERE i.Note = 'lotto 31'
  and v.Dbi_Original_Key_Pr = i.Cncon
  and  v.Dbi_Original_Key_Pr=g.pr
   AND a.Acquisizione = v.Cfreq
   AND a.Ctar1 = v.Ctar1
   AND a.Operando = b.Operando
   AND b.Tipo = 'RATE TYPE'
   AND d.Dbi_Punto_Key = v.Dbi_Original_Key_Pr
   AND d.valid_from=v.d_valido_dal
   And d.valid_until=v.d_valido_al
   AND d.Frequenza_Misura = v.Cfreq
   AND l.Indprog = g.Indprog
   --AND a.Prodotto = 'STD_TANDEM'
GROUP BY v.Dbi_Original_Key_Pr , --0
       v.CPOD, --1
       a.Operando,v.cdsti,
      Get_Ab2(b.Operando, a.Ctar1, v.cdsti, Data_Validita), --3
      Get_Bis2(b.Operando,a.Ctar1,v.cdsti,v.cdces,Data_Validita_Al) , --4
     Get_Param_Valori_Tarifart(a.Operando,a.Ctar1,Dec_Stagruver(v.Ctfor),Dec_Spebene(v.Crete, d.Tensione),TRIM(TO_CHAR(d.potenza_impegnata)),DEC_CTFOR(v.CTFOR),l.Indprov,l.Indccom,d.Cd_Tariffa_Distr_norm,a.acquisizione) , --5
    GET_PARAM_VALORI_KOND(a.Operando,a.Ctar1,Dec_Stagruver(v.Ctfor),Dec_Spebene(v.Crete, d.Tensione),TRIM(TO_CHAR(d.potenza_impegnata)),DEC_CTFOR(v.CTFOR),l.Indprov,l.Indccom,d.Cd_Tariffa_Distr_norm,a.acquisizione,v.d_valido_dal), --6
       b.Id_Operando
       order by v.cdsti
     ]]></mainSelect>
		
		     <insertTable name='FACTS_F_RATE_TYPE' truncate = 'True' break_index='' >
		     <field name='LEGACY' index='0' />
		     <field name='TIPO' constant_value='F_RATE' />
		     <field name='OPERAND' index = '2'  />
		     <field name='SAISON' constant_value='' />
		     <field name='PROG'   index= '7'/>
		     <field name='CPOD'   index= '1'/>
		   </insertTable> 
		   <insertTable name='FACTS_V_RATE_TYPE' truncate = 'True' break_index='' >
		      <field name='LEGACY' index='0' />
		     <field name='TIPO' constant_value='V_RATE' />
		     <field name='AB'   index='3' />
		     <field name='BIS' index='4' />
		      <field name='TARIFART' index='5' />
		     <field name='KONDIGR' index='6' />
		     <field name='PROG'  index ='7' />
		     <field name='CPOD'   index= '1'/>
		     </insertTable> 
		
	</RateAggregator>
	<RateExtractor>
		<mainSelect ><![CDATA[
		SELECT
               FACTS_KEY.LEGACY||facts_f_rate_type.operand||facts_v_rate_type.ab,  --0
               FACTS_KEY.TIPO,--1
               FACTS_KEY.ANLAGE, --2
               FACTS_KEY.BIS, --3
               facts_f_rate_type.legacy||facts_f_rate_type.operand||facts_v_rate_type.ab, --4
               facts_f_rate_type.tipo, --5
               facts_f_rate_type.operand, --6
               facts_f_rate_type.saison, --7
               facts_f_rate_type.prog, --8
               facts_v_rate_type.legacy||facts_f_rate_type.operand||facts_v_rate_type.ab, --9
               facts_v_rate_type.tipo, --10
                facts_v_rate_type.ab, --11
               facts_v_rate_type.bis, --12
               facts_v_rate_type.tarifart, --13
               facts_v_rate_type.kondigr, --14
              facts_v_rate_type.prog --15
              from facts_key,facts_f_rate_type,facts_v_rate_type
              where facts_key.legacy = facts_f_rate_type.legacy
              and facts_v_rate_type.legacy=facts_key.legacy
              and facts_f_rate_type.legacy=facts_v_rate_type.legacy
              and facts_f_rate_type.prog=facts_v_rate_type.prog
              order by facts_f_rate_type.prog
           ]]></mainSelect>
         <csvLine line_index='00' break_index='0'  field_start_index='0'  field_end_index='3' >
          </csvLine>
         <csvLine line_index='01' break_index=''   field_start_index='4'  field_end_index='7'   >
         </csvLine>       
         <csvLine line_index='02' break_index=''   field_start_index='9'  field_end_index='14'  >
         </csvLine>   
         <ende field_index='0' />
	</RateExtractor>
	</queries>
</root>

