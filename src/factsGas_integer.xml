<root>
	<queries>
	<IntegerAggregator>
		<mainSelect ><![CDATA[
       SELECT A.CNCON,  --0
               A.CNCON,        --1
               b.operando,   --2
              -- to_char(a.cdsti,'yyyymmdd'),--3
              '20090701',
               b.data_validita_al, --4
              case when b.operando='GI_PRELIEV' then substr(e.CD_PROF_USO,5) else b.valori end case, --5  
               b.prezzo, --6
               c.id_operando ,  --7
              -- d.volumi_annui_anu, --8 
             --DEC_GIORNI_PRELIEVO(D.tipo_profilo_utilizzo_anu) --8
              d.classe_prelievo_anu
              FROM DBI_USER.IFC_SAP_ANAGRCONTRGAS A,z_prodotto_operando b,z_anagrafica_operandi c,dbi_user.ifc_delibera_gas D,
              dbi_user.ifc_sap_punti_fornitura e
             WHERE b.operando=c.operando
               and a.CNCON IN (SELECT CNCON FROM Z_pr_in_lavorazione_gas)
               and a.ctar1=b.ctar1
                and e.dbi_punto_key = a.cncon
                AND d.pr_anu=A.CNCON
                and b.ctar1='F3M'
               AND C.TIPO='INTEGER'
               group by a.cncon,
               A.CNCON,
               b.operando,
                 to_char(a.cdsti,'yyyymmdd'),--3
               b.data_validita_al,
               b.valori,
             b.prezzo,e.CD_PROF_USO,
                c.id_operando ,
               d.volumi_annui_anu,
                 d.classe_prelievo_anu
               order by a.cncon
        ]]></mainSelect>
		
		<insertTable name='GAS_FACTS_KEY' truncate = 'False' break_index='0'    >
		     <field name='LEGACY' index='0' />
		     <field name='TIPO' constant_value='KEY' />
		     <field name='ANLAGE' index='1' />
		     <field name='BIS' constant_value='99991231' />
		   </insertTable> 
		     <insertTable name='EMG_FACTS_INTEGER' truncate = 'True' break_index='' >
		     <field name='LEGACY' index='0' />
		     <field name='TIPO' constant_value='F_INTE' />
		     <field name='OPERAND' index = '2'  />
		     <field name='SAISON' constant_value='' />
		     <field name='PROG'   index= '7'/>
		   </insertTable> 
		   <insertTable name='EMG_VALUE_INTEGER' truncate = 'True' break_index='' >
		      <field name='LEGACY' index='0' />
		     <field name='TIPO' constant_value='V_INTE' />
		     <field name='AB'   index='3' />
		     <field name='BIS' index='4' />
		      <field name='INTEGER4' index='5' />
		      <field name='TARIFART' constant_value='' />
		     <field name='KONDIGR' constant_value='' />
		     <field name='PROG'  index ='7' />
		     </insertTable> 		
	</IntegerAggregator>
	<IntegerExtractor>
		<mainSelect ><![CDATA[
		SELECT
               FACTS_KEY.LEGACY,  --0
               FACTS_KEY.TIPO,--1
               FACTS_KEY.ANLAGE, --2
               FACTS_KEY.BIS, --3
               EMG_FACTS_INTEGER.legacy, --4
               EMG_FACTS_INTEGER.tipo, --5
               EMG_FACTS_INTEGER.operand, --6
               EMG_FACTS_INTEGER.saison, --7
               EMG_FACTS_INTEGER.prog, --8
               EMG_VALUE_INTEGER.legacy, --9
               EMG_VALUE_INTEGER.tipo, --10
               EMG_VALUE_INTEGER.ab, --11
               EMG_VALUE_INTEGER.bis, --12
               EMG_VALUE_INTEGER.integer4, --13
               EMG_VALUE_INTEGER.tarifart, --14
               EMG_VALUE_INTEGER.kondigr, --15
               EMG_VALUE_INTEGER.prog --16
              from facts_key,EMG_FACTS_INTEGER,EMG_VALUE_INTEGER
              where facts_key.legacy = EMG_FACTS_INTEGER.legacy
              and EMG_VALUE_INTEGER.legacy=facts_key.legacy
              and EMG_FACTS_INTEGER.legacy=EMG_VALUE_INTEGER.legacy
              and EMG_FACTS_INTEGER.prog=EMG_VALUE_INTEGER.prog
              order by EMG_FACTS_INTEGER.prog
           ]]></mainSelect>
         <csvLine line_index='00' break_index='0'  field_start_index='0'  field_end_index='3' >
          </csvLine>
         <csvLine line_index='01' break_index=''   field_start_index='4'  field_end_index='7'   >
         </csvLine>       
         <csvLine line_index='02' break_index=''   field_start_index='9'  field_end_index='15'  >
         </csvLine>   
         <ende field_index='0' />
	</IntegerExtractor>
	</queries>
</root>

